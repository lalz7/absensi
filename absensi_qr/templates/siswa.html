{% extends "base.html" %}

{% block title %}Kelola Siswa{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Formulir Tambah/Edit Siswa -->
    <div class="card p-4 shadow-sm mb-4">
        <h5 class="card-title">
            {% if siswa_edit %}
            <i class="bi bi-pencil-square me-2"></i>Edit Data Siswa
            {% else %}
            <i class="bi bi-plus-circle me-2"></i>Tambah Data Siswa
            {% endif %}
        </h5>

        <form action="{{ url_for('siswa', edit_id=siswa_edit.id if siswa_edit else '') }}" method="post">
            <div class="row g-3">
                <div class="col-md-3">
                    <label for="nis" class="form-label">NIS</label>
                    <input type="text" class="form-control" id="nis" name="nis" value="{{ siswa_edit.nis if siswa_edit else '' }}" required>
                </div>
                <div class="col-md-4">
                    <label for="nama" class="form-label">Nama</label>
                    <input type="text" class="form-control" id="nama" name="nama" value="{{ siswa_edit.nama if siswa_edit else '' }}" required>
                </div>
                <div class="col-md-3">
                    <label for="kelas" class="form-label">Kelas</label>
                    <input type="text" class="form-control" id="kelas" name="kelas" value="{{ siswa_edit.kelas if siswa_edit else '' }}" required>
                </div>
                <div class="col-md-2">
                    <label for="no_hp" class="form-label">No. HP Orang Tua</label>
                    <input type="tel" class="form-control" id="no_hp" name="no_hp" value="{{ siswa_edit.no_hp_ortu if siswa_edit else '' }}" required>
                </div>
                <div class="col-12 mt-4">
                    <button type="submit" class="btn btn-primary me-2">
                        {% if siswa_edit %}
                        Simpan Perubahan
                        {% else %}
                        Tambahkan Siswa
                        {% endif %}
                    </button>
                    {% if siswa_edit %}
                    <a href="{{ url_for('siswa') }}" class="btn btn-secondary">Batal Edit</a>
                    {% endif %}
                </div>
            </div>
        </form>
    </div>

    <!-- Form Pencarian dan Filter -->
    <div class="card p-4 shadow-sm mb-4">
        <h5 class="card-title"><i class="bi bi-search me-2"></i>Cari & Filter Siswa</h5>
        <form action="{{ url_for('siswa') }}" method="get">
            <div class="row g-3">
                <div class="col-md-5">
                    <label for="cari_nama" class="form-label">Nama Siswa</label>
                    <input type="text" class="form-control" id="cari_nama" name="cari_nama" value="{{ cari_nama if cari_nama }}">
                </div>
                <div class="col-md-5">
                    <label for="filter_kelas" class="form-label">Filter Kelas</label>
                    <select class="form-select" id="filter_kelas" name="filter_kelas">
                        <option value="">-- Semua Kelas --</option>
                        {% for k in semua_kelas %}
                        <option value="{{ k }}" {% if filter_kelas == k %}selected{% endif %}>{{ k }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-dark w-100">Cari</button>
                </div>
            </div>
        </form>
    </div>

    <!-- Tabel Daftar Siswa -->
    <div class="card shadow-sm">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0"><i class="bi bi-list-ul me-2"></i>Daftar Siswa</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr class="bg-light">
                            <th>No</th>
                            <th>NIS</th>
                            <th>Nama</th>
                            <th>Kelas</th>
                            <th>No. HP Orang Tua</th>
                            <th>QR Code</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for siswa_data in siswa %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ siswa_data.nis }}</td>
                            <td>{{ siswa_data.nama }}</td>
                            <td>{{ siswa_data.kelas }}</td>
                            <td>{{ siswa_data.no_hp_ortu }}</td>
                            <td>
                                <img src="{{ url_for('view_qr', nis=siswa_data.nis) }}" alt="QR Code" style="width: 50px; height: auto;">
                            </td>
                            <td class="text-nowrap">
                                <a href="{{ url_for('siswa', edit_id=siswa_data.id) }}" class="btn btn-warning btn-sm me-1"><i class="bi bi-pencil"></i> Edit</a>
                                <a href="{{ url_for('hapus_siswa', id=siswa_data.id) }}" class="btn btn-danger btn-sm me-1" onclick="return confirm('Apakah Anda yakin ingin menghapus data siswa ini?')"><i class="bi bi-trash"></i> Hapus</a>
                                <a href="{{ url_for('download_qr', nis=siswa_data.nis) }}" class="btn btn-info btn-sm text-white"><i class="bi bi-download"></i> Download QR</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
